# Claude AI Collaboration Guidelines

## Overview

このドキュメントは、GitHub上でClaude AIを活用してエピックレベルの議論、コードレビュー、技術的な相談を行うためのガイドラインです。

## When to Use Claude / Claudeを使うタイミング

### 1. エピック分解 (Epic Breakdown)
大規模な機能開発を開始する前に、エピックをサブイシューに分解する際に活用します。

```markdown
@claude このエピックについて、どのようなサブイシューに分解すべきか提案してください。特に以下の観点から検討をお願いします：
1. 技術的な実装順序
2. 依存関係の管理
3. リスクの最小化
```

### 2. アーキテクチャレビュー (Architecture Review)
設計段階でアーキテクチャの妥当性を確認します。

```markdown
@claude この設計について以下の観点でレビューをお願いします：
- セキュリティ面での懸念点
- スケーラビリティ
- 保守性
```

### 3. PRレビュー (Pull Request Review)
コードレビューの補助として活用します。

```markdown
@claude このPRについて以下をレビューしてください：
- コードの品質
- セキュリティ上の問題
- パフォーマンスの改善余地
```

### 4. 技術的な相談 (Technical Consultation)
複雑な技術的課題の解決策を検討します。

```markdown
@claude この問題について最適な解決方法を提案してください：
[問題の詳細説明]
```

## Best Practices / ベストプラクティス

### 1. 明確なコンテキストの提供
- 背景情報を十分に含める
- 関連するコードやドキュメントへのリンクを提供
- 具体的な質問や依頼事項を明記

### 2. 構造化された質問
```markdown
## 背景
[なぜこの議論が必要か]

## 現状
[現在の状況や制約]

## 質問
1. [具体的な質問1]
2. [具体的な質問2]

## 期待する成果
[どのような回答を期待しているか]
```

### 3. 言語の使い分け
- 日本語・英語どちらでも対応可能
- チームの共通言語に合わせて選択
- 技術用語は英語のまま使用することを推奨

## Creating Effective Sub-Issues / 効果的なサブイシューの作成

### サブイシューの品質基準

優れたサブイシューは、以下の特徴を持ちます：

1. **独立性**: 他のタスクの完了を待たずに着手できる、または依存関係が明確
2. **完結性**: 単独で価値を提供し、テスト可能な成果物を生成
3. **明確性**: 誰が見ても何をすべきかが理解できる
4. **適切なサイズ**: 1-3日程度で完了できる作業量

### サブイシューに含めるべき要素

#### 1. 背景とコンテキスト
```markdown
## 背景とコンテキスト
- **エピックの目的**: [このサブイシューが属するエピックの全体目標]
- **このタスクの役割**: [エピック全体の中でこのタスクが果たす役割]
- **ビジネス価値**: [このタスクが提供する価値]
```

#### 2. 前提条件と依存関係
```markdown
## 前提条件
- [ ] 必要な事前作業: [完了している必要がある他のissue番号]
- [ ] 必要な環境: [開発環境、ツール、アクセス権限]
- [ ] 必要な知識: [このタスクに必要な技術知識やドメイン知識]

## 依存関係
- ブロックされるタスク: #123, #124
- このタスクをブロックするもの: #120
```

#### 3. 明確な成果物定義
```markdown
## 成果物
### 作成/修正するもの
- [ ] `src/services/newfeature.py` - 新機能の実装
- [ ] `tests/test_newfeature.py` - ユニットテスト
- [ ] `docs/newfeature.md` - 機能のドキュメント

### 期待される動作
- 入力: [具体的な入力例]
- 出力: [期待される出力例]
- エラーケース: [想定されるエラーと対処]
```

#### 4. 具体的な実装指針
```markdown
## 実装指針
1. 既存の`base_service.py`を継承して実装
2. エラーハンドリングは`custom_exceptions.py`のパターンに従う
3. ログ出力は`logger`モジュールを使用
4. 設定は環境変数から読み込む（`config.py`参照）
```

#### 5. テストと検証方法
```markdown
## テストと検証
### ユニットテスト
```bash
pytest tests/test_newfeature.py -v
```

### 統合テスト
```bash
docker-compose up -d
python scripts/integration_test.py
```

### 動作確認手順
1. [具体的な手順1]
2. [具体的な手順2]
3. [期待される結果]
```

#### 6. 完了の定義（Definition of Done）
```markdown
## 完了の定義
- [ ] コードが実装されている
- [ ] ユニットテストが書かれ、パスしている
- [ ] ドキュメントが更新されている
- [ ] コードレビューが完了している
- [ ] CI/CDがグリーンである
- [ ] 関連するissueにリンクされている
```

### エピック分解時のClaudeへの依頼例

```markdown
@claude このエピックをサブイシューに分解してください。各サブイシューには以下を含めてください：

1. **独立した背景説明**: 他のissueを見なくても理解できる説明
2. **明確な前提条件**: 必要な事前作業、環境、知識
3. **具体的な成果物**: 作成するファイル、期待される動作
4. **実装指針**: 既存コードとの整合性、使用すべきパターン
5. **テスト方法**: 具体的なテストコマンドと確認手順
6. **完了の定義**: チェックリスト形式の完了条件

特に、各サブイシューが別の開発者に割り当てられても、スムーズに作業を開始できるような記述を心がけてください。
```

## What Claude Can Do / Claudeができること

### ✅ 推奨される使用方法
- **エピックの分解提案**: 大規模機能をサブタスクに分解
- **コードレビュー**: セキュリティ、パフォーマンス、可読性の観点から分析
- **アーキテクチャ設計**: 設計パターンの提案や改善点の指摘
- **技術調査**: 技術選定や実装方法の比較検討
- **ドキュメント作成支援**: READMEや設計書の構成提案
- **テスト戦略**: テストケースの提案やテスト計画の立案

### ❌ 制限事項
- **最終的な意思決定**: 人間のレビュアーが行う
- **本番環境へのアクセス**: セキュリティ上不可
- **機密情報の処理**: 公開情報のみを扱う
- **リアルタイムな対話**: 非同期のコメントベース

## Security Guidelines / セキュリティガイドライン

### 共有してはいけない情報
- APIキー、パスワード、トークン
- 個人情報（PII）
- 社内の機密情報
- 未公開の製品情報

### 安全な情報共有の例
```markdown
# 良い例 ✅
DATABASE_URL=postgresql://user:***@localhost/db

# 悪い例 ❌
DATABASE_URL=postgresql://admin:actualPassword123@prod.example.com/maindb
```

## Integration with Development Flow / 開発フローとの統合

### 1. Issue作成時
```markdown
## エピックの概要
[機能の説明]

## Claudeへの相談事項
@claude このエピックを実装するために必要なサブイシューを提案してください。
```

### 2. PR作成時

**重要**: ClaudeへのメンションはPR本文ではなく、PR作成後の最初のコメントで行ってください。

```markdown
# PR本文には通常の内容を記載
## 変更内容
[PRの説明]

## テスト
[テスト内容]

# PR作成後、最初のコメントでClaudeにレビュー依頼
@claude 以下の観点でレビューをお願いします：
- [ ] アーキテクチャの妥当性
- [ ] セキュリティ上の懸念
- [ ] パフォーマンスの最適化
```

### 3. 設計ドキュメント作成時
```markdown
## 設計案
[設計の詳細]

## Claudeへの確認事項
@claude この設計について改善点や懸念事項があれば指摘してください。
```

## Response Time Expectations / 応答時間の目安

- **通常**: 数分以内に応答
- **複雑な分析**: 5-10分程度
- **大規模なコードレビュー**: 10-15分程度

※ これらは目安であり、システムの負荷状況により変動する可能性があります

## Examples / 実例

### エピック分解の例
```markdown
@claude 

## エピック: マルチプラットフォーム対応

### 背景
現在RPi4のみ対応しているドライバーシステムを、Jetson NanoやBeagleBone Blackにも対応させたい。

### 制約
- 既存のRPi4機能は維持
- 各プラットフォーム固有の最適化を可能に
- 共通コードは70%以上を目指す

### 質問
1. このエピックをどのようなサブイシューに分解すべきか？
2. 実装の優先順位をどう設定すべきか？
3. プラットフォーム間の差異をどう吸収すべきか？
```

### PRレビューの例
```markdown
@claude

このPRでは権限分離アーキテクチャを実装しています。

## レビューポイント
1. privilegedコンテナの実装が最小限になっているか
2. サービス間の通信にセキュリティ上の問題がないか
3. エラーハンドリングが適切か

関連ファイル:
- services/detector/detector.py
- docker-compose.yml
```

## Troubleshooting / トラブルシューティング

### Claudeが応答しない場合
1. メンション形式が正しいか確認（`@claude`）
2. GitHubのインテグレーションが有効か確認
3. しばらく待ってから再試行

### 期待した回答が得られない場合
1. 質問をより具体的に
2. 必要なコンテキストを追加
3. 質問を小さく分割

## Continuous Improvement / 継続的な改善

このガイドラインは、実際の使用経験に基づいて継続的に改善されます。改善提案がある場合は、Issueを作成してください。

---

**Note**: このドキュメントは生きたドキュメントであり、チームの経験とフィードバックに基づいて更新されます。